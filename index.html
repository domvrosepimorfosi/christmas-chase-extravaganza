<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Christmas Chase Extravaganza ğŸ„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@400;700&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background: radial-gradient(circle at top, #0f4c28, #022c22); /* Deep Xmas Green */
            color: #ffffff;
            padding-top: 2rem;
            padding-bottom: 2rem;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        h1, h2, h3, .festive-font, footer {
            font-family: 'Mountains of Christmas', cursive;
        }

        /* --- Snow Animation --- */
        .snowflake {
            position: fixed;
            top: -10px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1em;
            pointer-events: none;
            z-index: 0;
            animation: fall linear infinite;
        }
        @keyframes fall {
            0% { transform: translateY(0vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }

        /* --- Animations --- */
        @keyframes twinkle-gold {
            0%, 100% { box-shadow: 0 0 10px #eab308; border-color: #fca5a5; }
            50% { box-shadow: 0 0 25px #fbbf24; border-color: #ef4444; }
        }
        .pulse-gold { animation: twinkle-gold 2s infinite; }

        @keyframes pulse-grinch {
            0%, 100% { transform: scale(1); box-shadow: 0 0 10px #4ade80; }
            50% { transform: scale(1.05); box-shadow: 0 0 25px #22c55e; }
        }
        .pulse-grinch { animation: pulse-grinch 2s infinite; }
        
        @keyframes flash-green {
            0%, 100% { background-color: #15803d; transform: scale(1); }
            50% { transform: scale(1.05); background-color: #22c55e; }
        }
        .flash-green { animation: flash-green 0.5s ease; }

        @keyframes flash-red {
            0%, 100% { background-color: #b91c1c; transform: scale(1); }
            50% { transform: scale(1.05); background-color: #ef4444; }
        }
        .flash-red { animation: flash-red 0.5s ease; }

        /* --- Game Board --- */
        .game-board {
            display: grid;
            grid-template-rows: repeat(7, 1fr);
            width: 320px;
            height: 550px;
            background: rgba(255, 255, 255, 0.1);
            border: 6px solid #b91c1c; /* Christmas Red */
            border-radius: 1.5rem;
            margin-top: 1rem;
            position: relative;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.3);
            backdrop-filter: blur(5px);
        }
        .board-step {
            border-bottom: 2px dashed #fca5a5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-family: 'Mountains of Christmas', cursive;
            font-weight: 700;
            color: #fcd34d; /* Gold */
            position: relative;
        }
        .board-step:last-child {
            border-bottom: none;
            background-color: #15803d; /* Green "Home" */
            border-bottom-left-radius: 1.2rem;
            border-bottom-right-radius: 1.2rem;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .board-step:first-child {
            border-top-left-radius: 1.2rem;
            border-top-right-radius: 1.2rem;
        }
        
        /* --- Player Icons --- */
        .player-icon, .chaser-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 2rem;
            transition: transform 0.5s ease-in-out;
            z-index: 10;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .player-icon {
            background-color: #dc2626; /* Santa Red */
            border: 3px solid #ffffff;
            left: 15%;
        }
        .chaser-icon {
            background-color: #4ade80; /* Grinch Green */
            border: 3px solid #14532d;
            right: 15%;
        }
        
        /* --- Custom Message Box --- */
        #message-box {
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 100;
        }
    </style>
</head>

<body class="text-white selection:bg-red-500 selection:text-white">

    <div id="snow-container"></div>

    <img src="logo.png" alt="Logo" class="absolute top-4 left-4 w-24 md:w-32 z-20 mix-blend-multiply filter brightness-110">


    <div class="relative w-full max-w-5xl mx-auto text-center px-4 z-10 flex-grow">

        <h1 class="text-6xl md:text-7xl font-bold text-yellow-300 mb-2 drop-shadow-[0_5px_5px_rgba(0,0,0,0.5)]">
            THE CHRISTMAS CHASE ğŸ…
        </h1>
        <p class="text-2xl text-red-200 mb-8 font-bold tracking-widest">ğŸ„ HOLIDAY EXTRAVAGANZA EDITION ğŸ„</p>

        <div class="bg-red-900 bg-opacity-80 p-4 rounded-3xl shadow-2xl mb-6 border-4 border-yellow-500">
            <h2 class="text-3xl font-bold text-yellow-300 mb-4">ğŸ SANTA'S GIFT LIST (FINAL BANK) ğŸ</h2>
            <div class="flex flex-wrap justify-center gap-4">
                <div id="team-score-1" class="p-4 bg-green-900 rounded-xl shadow-inner border border-green-700 min-w-[120px]">
                    <div class="text-sm uppercase tracking-bold">Team 1</div>
                    <span class="font-bold text-2xl text-yellow-300" id="team-1-score">0</span> ğŸ
                </div>
                <div id="team-score-2" class="p-4 bg-green-900 rounded-xl shadow-inner border border-green-700 min-w-[120px]">
                    <div class="text-sm uppercase tracking-bold">Team 2</div>
                    <span class="font-bold text-2xl text-yellow-300" id="team-2-score">0</span> ğŸ
                </div>
                <div id="team-score-3" class="p-4 bg-green-900 rounded-xl shadow-inner border border-green-700 min-w-[120px]">
                    <div class="text-sm uppercase tracking-bold">Team 3</div>
                    <span class="font-bold text-2xl text-yellow-300" id="team-3-score">0</span> ğŸ
                </div>
                <div id="team-score-4" class="p-4 bg-green-900 rounded-xl shadow-inner border border-green-700 min-w-[120px]">
                    <div class="text-sm uppercase tracking-bold">Team 4</div>
                    <span class="font-bold text-2xl text-yellow-300" id="team-4-score">0</span> ğŸ
                </div>
                <div id="team-score-5" class="p-4 bg-green-900 rounded-xl shadow-inner border border-green-700 min-w-[120px]">
                    <div class="text-sm uppercase tracking-bold">Team 5</div>
                    <span class="font-bold text-2xl text-yellow-300" id="team-5-score">0</span> ğŸ
                </div>
            </div>
            <button id="start-final-chase-btn" class="hidden mt-6 bg-gradient-to-r from-yellow-400 to-yellow-600 hover:from-yellow-500 hover:to-yellow-700 text-red-900 font-black py-3 px-8 rounded-full text-2xl transition-all shadow-[0_0_20px_rgba(253,224,71,0.6)] animate-bounce">
                ğŸŒŸ START THE FINAL SLEIGH RIDE ğŸŒŸ
            </button>
        </div>
        
        <div id="game-screens-container" class="bg-black bg-opacity-40 p-8 rounded-3xl shadow-2xl backdrop-blur-md min-h-[500px] mb-8 border-2 border-white/20">

            <div id="setup-screen">
                <h2 class="text-4xl font-bold mb-6 text-yellow-300">Who is playing next? ğŸ¦Œ</h2>
                <div id="team-selection" class="flex flex-wrap justify-center gap-6 mb-8">
                    <button class="team-select-btn p-6 bg-red-600 hover:bg-red-700 rounded-2xl font-bold text-xl w-40 transition-all shadow-lg border-b-4 border-red-800" data-team="0">Team 1 â„ï¸</button>
                    <button class="team-select-btn p-6 bg-red-600 hover:bg-red-700 rounded-2xl font-bold text-xl w-40 transition-all shadow-lg border-b-4 border-red-800" data-team="1">Team 2 â›„</button>
                    <button class="team-select-btn p-6 bg-red-600 hover:bg-red-700 rounded-2xl font-bold text-xl w-40 transition-all shadow-lg border-b-4 border-red-800" data-team="2">Team 3 ğŸ””</button>
                    <button class="team-select-btn p-6 bg-red-600 hover:bg-red-700 rounded-2xl font-bold text-xl w-40 transition-all shadow-lg border-b-4 border-red-800" data-team="3">Team 4 ğŸ•¯ï¸</button>
                    <button class="team-select-btn p-6 bg-red-600 hover:bg-red-700 rounded-2xl font-bold text-xl w-40 transition-all shadow-lg border-b-4 border-red-800" data-team="4">Team 5 ğŸª</button>
                </div>
                <button id="start-round-1-btn" class="bg-green-600 hover:bg-green-700 text-white font-black py-4 px-10 rounded-full text-2xl transition-all shadow-lg opacity-50 disabled:cursor-not-allowed" disabled>
                    Start Round 1: Gift Gatherer ğŸ
                </button>
            </div>

            <div id="cash-builder-screen" class="hidden">
                <h2 class="text-4xl font-bold text-yellow-300 mb-2">Round 1: Gift Gatherer ğŸ</h2>
                <h3 class="text-2xl mb-6 text-blue-200" id="r1-team-name">Team 1 is up!</h3>
                <div class="flex justify-center gap-12 items-center mb-8">
                    <div class="text-4xl font-bold bg-white/10 px-6 py-3 rounded-lg">â±ï¸ <span id="r1-timer" class="text-red-400">30</span>s</div>
                    <div class="text-4xl font-bold bg-white/10 px-6 py-3 rounded-lg">ğŸ <span id="r1-bank" class="text-green-400">0</span></div>
                </div>
                <button id="r1-start-timer-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-8 rounded-xl text-xl transition-all shadow-lg mb-6 border-b-4 border-indigo-900">
                    OPEN THE PRESENTS! (Start Timer)
                </button>
                
                <div id="r1-question-area" class="hidden">
                    <div class="bg-red-900 bg-opacity-60 p-8 rounded-2xl mb-6 min-h-[150px] flex items-center justify-center border-2 border-yellow-500 shadow-[0_0_15px_rgba(234,179,8,0.3)]">
                        <h2 id="r1-question-text" class="text-3xl font-semibold leading-relaxed">Question text...</h2>
                    </div>
                    <div id="r1-answer-buttons" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        </div>
                </div>
            </div>

            <div id="offer-screen" class="hidden">
                <div class="animate-bounce text-6xl mb-4">ğŸ…</div>
                <h2 class="text-4xl font-bold text-yellow-300 mb-6">Excellent Work!</h2>
                <p class="text-3xl mb-8">
                    <span id="offer-team-name">Team 1</span>, you gathered: <br>
                    <span id="offer-bank-amount" class="text-green-400 font-black text-6xl drop-shadow-lg">0</span> ğŸ
                </p>
                <p class="text-xl mb-10 text-gray-300">But now... you must face <span class="text-green-500 font-bold uppercase text-2xl">THE GRINCH!</span></p>
                
                <button id="start-round-2-btn" class="bg-red-600 hover:bg-red-700 text-white font-black py-5 px-12 rounded-full text-3xl transition-all shadow-[0_0_20px_#ef4444] pulse-gold">
                    FACE THE GRINCH! ğŸ‘¹
                </button>
            </div>

            <div id="head-to-head-screen" class="hidden">
                <h2 class="text-3xl font-bold text-yellow-300 mb-4">Round 2: Escape The Grinch!</h2>
                
                <div class="flex flex-col lg:flex-row justify-center items-center lg:items-start gap-12">
                    <div class="mt-6 w-full lg:w-1/3">
                        <div class="bg-blue-800 border-2 border-blue-500 text-white p-6 rounded-2xl shadow-lg mb-6 text-left">
                            <h3 class="text-xl font-bold mb-2 flex items-center gap-2"><span>ğŸ…</span> TEAM POT: <span id="r2-team-money" class="text-yellow-300">0</span> ğŸ</h3>
                            <p class="text-lg">Safe Steps Needed: <span id="r2-team-score" class="text-green-300 font-bold text-2xl">0</span> / 5</p>
                        </div>
                        <div class="bg-green-900 border-2 border-green-500 text-white p-6 rounded-2xl shadow-lg text-left">
                            <h3 class="text-xl font-bold mb-2 flex items-center gap-2"><span>ğŸ‘¹</span> THE GRINCH</h3>
                            <p class="text-lg">Steps Taken: <span id="r2-chaser-score" class="text-red-400 font-bold text-2xl">0</span> / 5</p>
                        </div>
                    </div>
                    
                    <div class="game-board">
                        <div class="player-icon" id="player-icon">ğŸ…</div>
                        <div class="chaser-icon" id="chaser-icon">ğŸ‘¹</div>
                        
                        <div class="board-step"></div> 
                        <div class="board-step"></div> 
                        <div class="board-step"></div> 
                        <div class="board-step">START</div> 
                        <div class="board-step"></div> 
                        <div class="board-step"></div> 
                        <div class="board-step">HOME ğŸ </div> 
                    </div>
                </div>

                <div id="r2-question-area" class="mt-8">
                    <div class="bg-white/10 p-6 rounded-xl mb-4 min-h-[120px] flex items-center justify-center border border-white/20">
                        <h2 id="r2-question-text" class="text-2xl font-semibold">Question...</h2>
                    </div>
                    <div id="r2-answer-buttons" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        </div>
                </div>
            </div>
            
            <div id="final-chase-team-screen" class="hidden">
                <h2 class="text-4xl font-bold text-yellow-300 mb-2">The Final Sleigh Ride ğŸ›·</h2>
                <p class="text-xl mb-6">Survivors: <span id="final-teams-list" class="font-bold text-green-400"></span></p>
                
                <div class="flex flex-wrap justify-around items-center my-8 bg-black bg-opacity-30 p-6 rounded-2xl gap-8 border border-white/10">
                    <div class="text-4xl font-bold">â±ï¸ <span id="final-team-timer" class="text-red-400">60</span>s</div>
                    <div class="text-4xl font-bold">ğŸ›¡ï¸ Target: <span id="final-team-score" class="text-green-400">0</span></div>
                    <div class="text-4xl font-bold">ğŸ Pot: <span id="final-pot" class="text-yellow-300">0</span></div>
                </div>
                
                <button id="final-team-start-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-8 rounded-xl text-2xl transition-all shadow-lg mb-6">
                    START THE CLOCK! â°
                </button>

                <div id="final-team-question-area" class="hidden">
                    <div class="bg-indigo-900/80 p-6 rounded-xl mb-4 min-h-[120px] flex items-center justify-center border border-indigo-500">
                        <h2 id="final-team-question-text" class="text-2xl font-semibold">Question...</h2>
                    </div>
                    <div id="final-team-answer-buttons" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        </div>
                </div>
            </div>
            
            <div id="final-chase-chaser-screen" class="hidden">
                <h2 class="text-4xl font-bold text-red-500 mb-2 font-festive">The Grinch's Turn ğŸ‘¹</h2>
                <p class="text-xl mb-4 text-gray-300">He's coming to steal the presents!</p>
                
                <div class="flex flex-wrap justify-around items-center my-6 bg-black bg-opacity-30 p-6 rounded-2xl gap-8 border border-red-900/50">
                    <div class="text-4xl font-bold">â±ï¸ <span id="final-chaser-timer" class="text-red-400">60</span>s</div>
                    <div class="text-3xl font-bold">Target: <span id="final-chaser-team-target" class="text-green-400">0</span></div>
                    <div class="text-3xl font-bold">Grinch: <span id="final-chaser-score" class="text-red-400">0</span></div>
                </div>

                <div id="final-chaser-question-area" class="hidden bg-red-900/40 p-6 rounded-xl mb-6 min-h-[150px] flex items-center justify-center border border-red-500/30">
                    <h2 id="final-chaser-question-text" class="text-3xl font-semibold">Question...</h2>
                </div>
                
                <button id="final-chaser-start-btn" class="pulse-grinch bg-green-700 hover:bg-green-600 text-white font-black py-4 px-8 rounded-full text-2xl transition-all shadow-lg mb-6 border-4 border-green-900">
                    RELEASE THE GRINCH!
                </button>
                
                <div id="teacher-controls" class="hidden mt-6">
                    <h3 class="text-lg text-yellow-300 mb-4 italic">(Teacher Control Panel)</h3>
                    <div id="teacher-main-controls" class="flex justify-center gap-6">
                        <button id="chaser-correct-btn" class="bg-green-600 hover:bg-green-500 text-white font-bold py-4 px-8 rounded-xl text-xl transition-all shadow-lg border-b-4 border-green-800 active:translate-y-1">
                            âœ… CORRECT
                        </button>
                        <button id="chaser-incorrect-btn" class="bg-red-600 hover:bg-red-500 text-white font-bold py-4 px-8 rounded-xl text-xl transition-all shadow-lg border-b-4 border-red-800 active:translate-y-1">
                            âŒ INCORRECT
                        </button>
                    </div>
                    
                    <div id="teacher-pushback-controls" class="hidden mt-4 bg-blue-900/50 p-4 rounded-xl">
                        <h3 class="text-xl text-cyan-300 mb-4 font-bold animate-pulse">âœ‹ PUSHBACK OPPORTUNITY! âœ‹</h3>
                        <div class="flex justify-center gap-6">
                            <button id="pushback-correct-btn" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-6 rounded-lg transition-all shadow-lg border-b-4 border-blue-800">
                                Team Got It! (Pushback)
                            </button>
                             <button id="pushback-incorrect-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-6 rounded-lg transition-all shadow-lg border-b-4 border-gray-800">
                                Team Missed (Continue)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="end-screen" class="hidden text-center">
                <div id="end-emoji" class="text-8xl mb-4 animate-bounce"></div>
                <h2 id="end-title" class="text-6xl font-festive mb-6 drop-shadow-lg"></h2>
                <p id="end-message" class="text-3xl mb-10 font-light"></p>
                <button id="play-again-btn" class="bg-yellow-500 hover:bg-yellow-400 text-red-900 font-black py-4 px-10 rounded-full text-2xl transition-all shadow-xl">
                    Play Again? ğŸ”„
                </button>
            </div>

        </div> </div> <footer class="w-full text-center py-6 mt-4 relative z-20">
        <p class="text-yellow-300 text-xl font-bold tracking-wider drop-shadow-md">
            ğŸ„ğŸ… Created by Panagiotis Domvros, English and Drama Teacher, All Rights Reserved ğŸ…ğŸ„
        </p>
    </footer>

    <audio id="chaser-music" src="The Chase (Enter The Chaser).mp3"></audio>

    <div id="message-box" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4 opacity-0 -translate-y-10">
        <div class="bg-white text-gray-900 p-8 rounded-3xl shadow-2xl max-w-md w-full text-center border-4 border-red-600 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-4 bg-red-600"></div>
            
            <h3 id="message-title" class="text-3xl font-bold mb-4 font-festive text-red-700">Message</h3>
            <p id="message-text" class="text-xl mb-8 font-semibold text-gray-700">This is the message.</p>
            <button id="message-ok-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-xl text-lg shadow-lg">
                OK ğŸ„
            </button>
        </div>
    </div>


    <script>
        // --- SNOW GENERATION ---
        function createSnow() {
            const snowContainer = document.getElementById('snow-container');
            const snowflakeCount = 50; 
            const characters = ['â„', 'â…', 'â†', 'â€¢'];
            
            for(let i=0; i<snowflakeCount; i++){
                const flake = document.createElement('div');
                flake.className = 'snowflake';
                flake.textContent = characters[Math.floor(Math.random() * characters.length)];
                flake.style.left = Math.random() * 100 + 'vw';
                flake.style.opacity = Math.random();
                flake.style.fontSize = (Math.random() * 1 + 0.5) + 'em';
                flake.style.animationDuration = (Math.random() * 3 + 7) + 's'; 
                flake.style.animationDelay = (Math.random() * 5) + 's';
                snowContainer.appendChild(flake);
            }
        }
        createSnow();

        // --- QUESTION DATABASE (B2 Level - 130+ UNIQUE QUESTIONS) ---
        
        // --- ROUND 1: RAPID FIRE (Vocab, simple facts, speed) ---
        const round1Questions = [
            { q: "What color is the Grinch?", a: [{ t: "Red", c: false }, { t: "Green", c: true }, { t: "Blue", c: false }] },
            { q: "Who is Scrooge's first name?", a: [{ t: "Ebenezer", c: true }, { t: "Charles", c: false }, { t: "Jacob", c: false }] },
            { q: "What is the name of the burglars in Home Alone?", a: [{ t: "Wet Bandits", c: true }, { t: "Sticky Fingers", c: false }, { t: "Bad Boys", c: false }] },
            { q: "Who sings 'All I Want for Christmas is You'?", a: [{ t: "Mariah Carey", c: true }, { t: "Ariana Grande", c: false }, { t: "Madonna", c: false }] },
            { q: "What was the first name of Jesus?", a: [{ t: "Jesus", c: true }, { t: "Joseph", c: false }, { t: "John", c: false }] },
            { q: "Where was Jesus born?", a: [{ t: "Bethlehem", c: true }, { t: "Jerusalem", c: false }, { t: "Nazareth", c: false }] },
            { q: "What gifts did the Three Kings bring?", a: [{ t: "Gold, Frankincense, Myrrh", c: true }, { t: "Silver, Gold, Diamond", c: false }, { t: "Toys, Food, Wine", c: false }] },
            { q: "What is December 26th called in the UK?", a: [{ t: "Boxing Day", c: true }, { t: "Present Day", c: false }, { t: "St. Patrick's Day", c: false }] },
            { q: "What Scottish song is sung on New Year's Eve?", a: [{ t: "Auld Lang Syne", c: true }, { t: "Jingle Bells", c: false }, { t: "Danny Boy", c: false }] },
            { q: "How do you say Merry Christmas in Spanish?", a: [{ t: "Feliz Navidad", c: true }, { t: "Buon Natale", c: false }, { t: "Joyeux Noel", c: false }] },
            { q: "What animal pulls Santa's sleigh?", a: [{ t: "Reindeer", c: true }, { t: "Horses", c: false }, { t: "Dogs", c: false }] },
            { q: "What is the shortest day of the year called?", a: [{ t: "Winter Solstice", c: true }, { t: "Summer Solstice", c: false }, { t: "Equinox", c: false }] },
            { q: "Who is the sister of Queen Elsa in Frozen?", a: [{ t: "Anna", c: true }, { t: "Olaf", c: false }, { t: "Sven", c: false }] },
            { q: "What building do they trap the guests in 'Die Hard'?", a: [{ t: "Nakatomi Plaza", c: true }, { t: "Empire State", c: false }, { t: "Trump Tower", c: false }] },
            { q: "What does Santa drink?", a: [{ t: "Milk", c: true }, { t: "Beer", c: false }, { t: "Juice", c: false }] },
            { q: "Which reindeer has a glowing red nose?", a: [{ t: "Rudolph", c: true }, { t: "Comet", c: false }, { t: "Cupid", c: false }] },
            { q: "What plant has red berries at Christmas?", a: [{ t: "Holly", c: true }, { t: "Ivy", c: false }, { t: "Rose", c: false }] },
            { q: "What plant do you kiss under?", a: [{ t: "Mistletoe", c: true }, { t: "Holly", c: false }, { t: "Pine", c: false }] },
            { q: "What is a snowman's nose made of?", a: [{ t: "Carrot", c: true }, { t: "Potato", c: false }, { t: "Coal", c: false }] },
            { q: "What month is Christmas Day?", a: [{ t: "December", c: true }, { t: "November", c: false }, { t: "January", c: false }] },
            { q: "Who is the villain in The Nutcracker?", a: [{ t: "The Mouse King", c: true }, { t: "The Rat Prince", c: false }, { t: "The Cat King", c: false }] },
            { q: "On the first day of Christmas, my true love gave to me...?", a: [{ t: "A Partridge", c: true }, { t: "A Dove", c: false }, { t: "A Hen", c: false }] },
            { q: "What is the shape of a candy cane?", a: [{ t: "J", c: true }, { t: "S", c: false }, { t: "I", c: false }] },
            { q: "How many candles are on a Menorah?", a: [{ t: "9", c: true }, { t: "7", c: false }, { t: "12", c: false }] },
            { q: "Santa enters the house through the...?", a: [{ t: "Chimney", c: true }, { t: "Window", c: false }, { t: "Back door", c: false }] },
            { q: "Who is the Pumpkin King?", a: [{ t: "Jack Skellington", c: true }, { t: "Oogie Boogie", c: false }, { t: "Sally", c: false }] },
            { q: "Who wrote 'A Christmas Carol'?", a: [{ t: "Charles Dickens", c: true }, { t: "Shakespeare", c: false }, { t: "J.K. Rowling", c: false }] },
            { q: "What is the name of the boy in Home Alone?", a: [{ t: "Kevin", c: true }, { t: "Harry", c: false }, { t: "Buzz", c: false }] },
            { q: "What is Frosty the Snowman made of?", a: [{ t: "Snow", c: true }, { t: "Ice", c: false }, { t: "Cotton", c: false }] },
            { q: "What vehicle does Santa drive?", a: [{ t: "Sleigh", c: true }, { t: "Car", c: false }, { t: "Truck", c: false }] },
            { q: "Where does Santa live?", a: [{ t: "North Pole", c: true }, { t: "South Pole", c: false }, { t: "Lapland", c: false }] },
            { q: "What treat do you leave for Santa?", a: [{ t: "Cookies", c: true }, { t: "Cake", c: false }, { t: "Chocolate", c: false }] },
            { q: "Who are Santa's helpers?", a: [{ t: "Elves", c: true }, { t: "Dwarves", c: false }, { t: "Minions", c: false }] },
            { q: "What decoration do you hang on the mantlepiece?", a: [{ t: "Stockings", c: true }, { t: "Scarves", c: false }, { t: "Hats", c: false }] },
            { q: "What date is Christmas Eve?", a: [{ t: "24th Dec", c: true }, { t: "25th Dec", c: false }, { t: "31st Dec", c: false }] },
            { q: "How many doors on an Advent Calendar?", a: [{ t: "24 or 25", c: true }, { t: "12", c: false }, { t: "30", c: false }] },
            { q: "What star sign are you if born on Christmas?", a: [{ t: "Capricorn", c: true }, { t: "Sagittarius", c: false }, { t: "Leo", c: false }] },
            { q: "Complete the song: 'Jingle Bells, Jingle Bells, Jingle all the...'", a: [{ t: "Way", c: true }, { t: "Day", c: false }, { t: "Time", c: false }] },
            { q: "What is the name of the green plant with needles?", a: [{ t: "Pine/Fir", c: true }, { t: "Oak", c: false }, { t: "Maple", c: false }] },
            { q: "Which city has a famous giant tree at Rockefeller Center?", a: [{ t: "New York", c: true }, { t: "London", c: false }, { t: "Paris", c: false }] },
            { q: "Who stole Christmas?", a: [{ t: "The Grinch", c: true }, { t: "Shrek", c: false }, { t: "Thanos", c: false }] },
            { q: "What is the opposite of 'Naughty'?", a: [{ t: "Nice", c: true }, { t: "Good", c: false }, { t: "Bad", c: false }] },
            { q: "What falls from the sky in winter?", a: [{ t: "Snow", c: true }, { t: "Sand", c: false }, { t: "Leaves", c: false }] },
            { q: "What color is Santa's belt?", a: [{ t: "Black", c: true }, { t: "Red", c: false }, { t: "Brown", c: false }] },
            { q: "What sound does Santa make?", a: [{ t: "Ho Ho Ho", c: true }, { t: "Ha Ha Ha", c: false }, { t: "Hee Hee Hee", c: false }] },
            { q: "What movie features a train to the North Pole?", a: [{ t: "Polar Express", c: true }, { t: "Thomas the Tank Engine", c: false }, { t: "Snowpiercer", c: false }] },
            { q: "What do you pull at a British Christmas dinner?", a: [{ t: "A Cracker", c: true }, { t: "A Leg", c: false }, { t: "A Rope", c: false }] },
            { q: "What metal is associated with Christmas bells?", a: [{ t: "Silver", c: true }, { t: "Iron", c: false }, { t: "Bronze", c: false }] },
            { q: "Who is the main elf in the movie 'Elf'?", a: [{ t: "Buddy", c: true }, { t: "Dobby", c: false }, { t: "Legolas", c: false }] },
            { q: "What candy is red and white stripes?", a: [{ t: "Candy Cane", c: true }, { t: "Lollipop", c: false }, { t: "Chocolate bar", c: false }] },
            { q: "What is the name of the Grinch's dog?", a: [{ t: "Max", c: true }, { t: "Rex", c: false }, { t: "Spot", c: false }] },
            { q: "How many letters in 'Christmas'?", a: [{ t: "9", c: true }, { t: "8", c: false }, { t: "10", c: false }] },
            { q: "What do you put on top of the tree?", a: [{ t: "Star/Angel", c: true }, { t: "Shoe", c: false }, { t: "Hat", c: false }] },
            { q: "If you stand under mistletoe, you must...?", a: [{ t: "Kiss", c: true }, { t: "Sing", c: false }, { t: "Dance", c: false }] },
            { q: "What day is New Year's Eve?", a: [{ t: "Dec 31st", c: true }, { t: "Jan 1st", c: false }, { t: "Dec 25th", c: false }] },
            { q: "What is white and minty?", a: [{ t: "Peppermint", c: true }, { t: "Cinnamon", c: false }, { t: "Chocolate", c: false }] },
        ];

        // --- ROUND 2: HEAD TO HEAD (Multiple Choice - Logic/Trivia) ---
        const round2Questions = [
            { q: "In Ukraine, what unlikely decoration is found on Christmas trees?", a: [{ t: "Spider webs", c: true }, { t: "Pickles", c: false }, { t: "Real candles", c: false }] },
            { q: "In Italy, who brings gifts to children on Epiphany Eve (Jan 5th)?", a: [{ t: "Santa Claus", c: false }, { t: "La Befana", c: true }, { t: "The Three Kings", c: false }] },
            { q: "The movie 'Die Hard' takes place on Christmas Eve in which city?", a: [{ t: "New York", c: false }, { t: "Los Angeles", c: true }, { t: "Chicago", c: false }] },
            { q: "In the song 'The Twelve Days of Christmas', what is given on the 5th day?", a: [{ t: "Gold Rings", c: true }, { t: "Calling Birds", c: false }, { t: "French Hens", c: false }] },
            { q: "The 'Krampus' is a scary Christmas figure from folklore in which region?", a: [{ t: "Scandinavia", c: false }, { t: "Alpine countries", c: true }, { t: "The British Isles", c: false }] },
            { q: "What famous Christmas song was originally written for Thanksgiving?", a: [{ t: "Silent Night", c: false }, { t: "Jingle Bells", c: true }, { t: "Deck the Halls", c: false }] },
            { q: "In Venezuela, how do people traditionally travel to church on Christmas morning?", a: [{ t: "On roller skates", c: true }, { t: "On horseback", c: false }, { t: "By boat", c: false }] },
            { q: "Which country donates the huge Christmas tree in Trafalgar Square, London?", a: [{ t: "Sweden", c: false }, { t: "Norway", c: true }, { t: "Canada", c: false }] },
            { q: "What are the two most popular Christmas colours after Red and Green?", a: [{ t: "Gold and Silver", c: true }, { t: "Blue and White", c: false }, { t: "Purple and Orange", c: false }] },
            { q: "What is the name of the snowman in 'Frozen'?", a: [{ t: "Kristoff", c: false }, { t: "Olaf", c: true }, { t: "Sven", c: false }] },
            { q: "In which ocean is Christmas Island located?", a: [{ t: "Pacific", c: false }, { t: "Indian", c: true }, { t: "Atlantic", c: false }] },
            { q: "What was the first company to use Santa Claus in its advertisements?", a: [{ t: "Coca-Cola", c: true }, { t: "Pepsi", c: false }, { t: "McDonalds", c: false }] },
            { q: "Which Christmas carol demands 'figgy pudding'?", a: [{ t: "We Wish You a Merry Christmas", c: true }, { t: "Joy to the World", c: false }, { t: "Hark the Herald Angels Sing", c: false }] },
            { q: "How many reindeer pull Santa's sleigh (including Rudolph)?", a: [{ t: "8", c: false }, { t: "9", c: true }, { t: "12", c: false }] },
            { q: "What happens to the winner of the 'Christmas Cracker' pull?", a: [{ t: "They wash the dishes", c: false }, { t: "They keep the contents", c: true }, { t: "They eat a sprout", c: false }] },
            { q: "Which country started the tradition of the Christmas Tree?", a: [{ t: "England", c: false }, { t: "Germany", c: true }, { t: "Norway", c: false }] },
            { q: "What famous ballet is traditionally performed at Christmas?", a: [{ t: "Swan Lake", c: false }, { t: "The Nutcracker", c: true }, { t: "Romeo & Juliet", c: false }] },
            { q: "Which country celebrates 'St. Lucia Day' with candles on heads?", a: [{ t: "Sweden", c: true }, { t: "Spain", c: false }, { t: "France", c: false }] },
            { q: "What does the word 'Noel' mean in Latin?", a: [{ t: "Birth", c: true }, { t: "Snow", c: false }, { t: "Gift", c: false }] },
            { q: "Which US President banned Christmas trees in the White House?", a: [{ t: "Teddy Roosevelt", c: true }, { t: "Lincoln", c: false }, { t: "JFK", c: false }] },
            { q: "How many ghosts visit Scrooge?", a: [{ t: "3", c: false }, { t: "4", c: true }, { t: "5", c: false }] }, // Marley + 3 Spirits
            { q: "What is the main course of a traditional Japanese Christmas dinner?", a: [{ t: "Sushi", c: false }, { t: "KFC Fried Chicken", c: true }, { t: "Ramen", c: false }] },
            { q: "Which country invented the gingerbread house?", a: [{ t: "Germany", c: true }, { t: "France", c: false }, { t: "Switzerland", c: false }] },
            { q: "In Harry Potter, what gift does Harry receive for his first Xmas?", a: [{ t: "Invisibility Cloak", c: true }, { t: "Broomstick", c: false }, { t: "Owl", c: false }] },
            { q: "What is the best selling Christmas single of all time?", a: [{ t: "White Christmas", c: true }, { t: "All I Want for Christmas", c: false }, { t: "Last Christmas", c: false }] },
            { q: "What political event happened on Xmas 1914?", a: [{ t: "The Christmas Truce", c: true }, { t: "The End of the War", c: false }, { t: "The Start of the War", c: false }] },
            { q: "Who plays the Grinch in the 2000 movie?", a: [{ t: "Jim Carrey", c: true }, { t: "Eddie Murphy", c: false }, { t: "Adam Sandler", c: false }] },
            { q: "What fruit is traditionally put in stockings?", a: [{ t: "Orange/Satsuma", c: true }, { t: "Apple", c: false }, { t: "Banana", c: false }] },
            { q: "Which country has the 'Yule Goat'?", a: [{ t: "Sweden", c: true }, { t: "Brazil", c: false }, { t: "China", c: false }] },
            { q: "What is 'Myrrh'?", a: [{ t: "A perfume/resin", c: true }, { t: "A gold coin", c: false }, { t: "A musical instrument", c: false }] }
        ];
        
        // --- FINAL CHASE: TEAM TURN (Mixed Bag) ---
        const finalChaseQuestions = [
            { q: "Who plays the Prime Minister in 'Love Actually'?", a: [{ t: "Hugh Grant", c: true }, { t: "Colin Firth", c: false }, { t: "Alan Rickman", c: false }] },
            { q: "What is the French name for Father Christmas?", a: [{ t: "Pere Noel", c: true }, { t: "Saint Nicholas", c: false }, { t: "Sinterklaas", c: false }] },
            { q: "Which popular Christmas beverage is also known as 'Milk Punch'?", a: [{ t: "Eggnog", c: true }, { t: "Hot Chocolate", c: false }, { t: "Mulled Wine", c: false }] },
            { q: "What is the highest grossing Christmas movie of all time?", a: [{ t: "Home Alone", c: true }, { t: "Elf", c: false }, { t: "The Grinch", c: false }] },
            { q: "In which direction should you stir mincemeat for good luck?", a: [{ t: "Clockwise", c: true }, { t: "Anti-clockwise", c: false }, { t: "Up and down", c: false }] },
            { q: "What type of tree is most commonly used as a Christmas tree?", a: [{ t: "Oak", c: false }, { t: "Fir (Spruce/Pine)", c: true }, { t: "Maple", c: false }] },
            { q: "When was the first Christmas card sent?", a: [{ t: "1843", c: true }, { t: "1901", c: false }, { t: "1750", c: false }] },
            { q: "What is the chemical formula for snow?", a: [{ t: "H2O", c: true }, { t: "CO2", c: false }, { t: "NaCl", c: false }] },
            { q: "Who tried to steal Christmas in a Dr. Seuss book?", a: [{ t: "The Grinch", c: true }, { t: "The Lorax", c: false }, { t: "Cat in the Hat", c: false }] },
            { q: "Which saint is celebrated on December 13th in Scandinavia?", a: [{ t: "St. Lucia", c: true }, { t: "St. Mary", c: false }, { t: "St. Anne", c: false }] },
            { q: "What decoration was originally made from silver strands?", a: [{ t: "Tinsel", c: true }, { t: "Baubles", c: false }, { t: "Lights", c: false }] },
            { q: "Which country issues a huge lottery prize known as 'El Gordo' at Christmas?", a: [{ t: "Spain", c: true }, { t: "Mexico", c: false }, { t: "Italy", c: false }] },
            { q: "What are the little people who help Santa?", a: [{ t: "Elves", c: true }, { t: "Gnomes", c: false }, { t: "Fairies", c: false }] },
            { q: "What time is the Queen/King's speech in the UK?", a: [{ t: "3 pm", c: true }, { t: "12 pm", c: false }, { t: "6 pm", c: false }] },
            { q: "What is a 'Buche de Noel'?", a: [{ t: "A chocolate log cake", c: true }, { t: "A type of wine", c: false }, { t: "A decoration", c: false }] },
            { q: "Who wrote 'The Nightmare Before Christmas'?", a: [{ t: "Tim Burton", c: true }, { t: "Walt Disney", c: false }, { t: "Dr. Seuss", c: false }] },
            { q: "What color is Elvis Presley's Christmas?", a: [{ t: "Blue", c: true }, { t: "Red", c: false }, { t: "White", c: false }] },
            { q: "What is 'Frankincense'?", a: [{ t: "Incense/Perfume", c: true }, { t: "Gold", c: false }, { t: "Spice", c: false }] },
            { q: "Where does the Polar Express take children?", a: [{ t: "North Pole", c: true }, { t: "South Pole", c: false }, { t: "Candyland", c: false }] },
            { q: "What happens if you are naughty?", a: [{ t: "You get coal", c: true }, { t: "You get candy", c: false }, { t: "You get gold", c: false }] },
            { q: "What date is Epiphany?", a: [{ t: "Jan 6th", c: true }, { t: "Jan 1st", c: false }, { t: "Dec 30th", c: false }] }
        ];
        
        // --- FINAL CHASE: GRINCH TURN (Verbal/Teacher Driven usually, but text provided) ---
        const finalChaseChaserQuestions = [
            { q: "In 'The Nightmare Before Christmas', who is the Pumpkin King?", a: [{ t: "Jack Skellington", c: true }, { t: "Oogie Boogie", c: false }, { t: "Sally", c: false }] },
            { q: "What is the date of Orthodox Christmas usually?", a: [{ t: "January 7th", c: true }, { t: "December 25th", c: false }, { t: "January 1st", c: false }] },
            { q: "Which US state was the first to recognize Christmas as a holiday?", a: [{ t: "Alabama", c: true }, { t: "New York", c: false }, { t: "Texas", c: false }] },
            { q: "What was the real St. Nicholas known for giving?", a: [{ t: "Gold coins", c: true }, { t: "Toys", c: false }, { t: "Food", c: false }] },
            { q: "Which fast food chain is popular in Japan on Christmas?", a: [{ t: "KFC", c: true }, { t: "McDonalds", c: false }, { t: "Burger King", c: false }] },
            { q: "In the UK, what is the day after Christmas called?", a: [{ t: "Boxing Day", c: true }, { t: "Giving Day", c: false }, { t: "Resting Day", c: false }] },
            { q: "What traditional Christmas decoration is a parasitic plant?", a: [{ t: "Mistletoe", c: true }, { t: "Ivy", c: false }, { t: "Holly", c: false }] },
            { q: "Who invented electric Christmas lights?", a: [{ t: "Thomas Edison (assistant)", c: true }, { t: "Benjamin Franklin", c: false }, { t: "Tesla", c: false }] },
            { q: "What is the most recorded Christmas song?", a: [{ t: "Silent Night", c: true }, { t: "Jingle Bells", c: false }, { t: "White Christmas", c: false }] },
            { q: "What is the German name for Christmas tree?", a: [{ t: "Tannenbaum", c: true }, { t: "Baum", c: false }, { t: "Blume", c: false }] },
            { q: "Which country has a tradition of a 'Christmas Sauna'?", a: [{ t: "Finland", c: true }, { t: "Russia", c: false }, { t: "Norway", c: false }] },
            { q: "What does the Grinch steal?", a: [{ t: "Christmas (Presents/Food)", c: true }, { t: "Halloween", c: false }, { t: "Easter", c: false }] },
            { q: "How many sides does a snowflake have?", a: [{ t: "6", c: true }, { t: "8", c: false }, { t: "4", c: false }] },
            { q: "Who is the mother of Jesus?", a: [{ t: "Mary", c: true }, { t: "Martha", c: false }, { t: "Ruth", c: false }] },
            { q: "Where did the Grinch live?", a: [{ t: "Mt. Crumpit", c: true }, { t: "Whoville", c: false }, { t: "The Cave", c: false }] },
            { q: "What brings Frosty the Snowman to life?", a: [{ t: "A Magic Hat", c: true }, { t: "A Magic Scarf", c: false }, { t: "A Carrot", c: false }] },
            { q: "In 'A Christmas Carol', who is the first ghost?", a: [{ t: "Christmas Past", c: true }, { t: "Christmas Present", c: false }, { t: "Marley", c: false }] }, // Actually Marley is first visitor, but Past is first "Christmas Ghost". Accept either usually.
            { q: "What currency do they use in the North Pole?", a: [{ t: "Snow dollars? (Trick question)", c: false }, { t: "None/Toy money", c: true }, { t: "Euros", c: false }] },
            { q: "What is the name of the dog in 'The Grinch'?", a: [{ t: "Max", c: true }, { t: "Sam", c: false }, { t: "Buddy", c: false }] },
            { q: "Which ocean is the North Pole in?", a: [{ t: "Arctic Ocean", c: true }, { t: "Pacific", c: false }, { t: "Atlantic", c: false }] }
        ];

        // --- Game State Variables ---
        let teamScores = [0, 0, 0, 0, 0];
        let teamPlayingStatus = [false, false, false, false, false]; 
        let currentActiveTeam = -1; 
        let currentCashBuilderBank = 0;
        let currentRound2TeamScore = 0;
        let currentRound2ChaserScore = 0;
        let finalChaseTeamScore = 0;
        let finalChaseChaserScore = 0;
        let finalChaseTotalPot = 0;
        
        let r1QuestionIndex = 0;
        let r2QuestionIndex = 0;
        let r3QuestionIndex = 0;
        let r3ChaserQuestionIndex = 0;
        
        let shuffledR1Questions = [];
        let shuffledR2Questions = [];
        let shuffledR3Questions = [];
        let shuffledR3ChaserQuestions = [];

        let timerId;
        let timerValue;
        
        // --- DOM Elements ---
        const screens = {
            setup: document.getElementById('setup-screen'),
            cashBuilder: document.getElementById('cash-builder-screen'),
            offer: document.getElementById('offer-screen'),
            headToHead: document.getElementById('head-to-head-screen'),
            finalTeam: document.getElementById('final-chase-team-screen'),
            finalChaser: document.getElementById('final-chase-chaser-screen'),
            end: document.getElementById('end-screen')
        };
        const messageBox = document.getElementById('message-box');
        const messageTitle = document.getElementById('message-title');
        const messageText = document.getElementById('message-text');
        const chaserMusic = document.getElementById('chaser-music');
        
        // --- Utility Functions ---
        
        function showScreen(screenId) {
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            if (screens[screenId]) {
                screens[screenId].classList.remove('hidden');
                // Scroll to top of game container
                document.getElementById('game-screens-container').scrollIntoView({behavior: 'smooth'});
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function showMessage(title, text, onOkCallback) {
            messageTitle.textContent = title;
            messageText.textContent = text;
            
            let oldOkBtn = document.getElementById('message-ok-btn');
            const newOkBtn = oldOkBtn.cloneNode(true);
            oldOkBtn.parentNode.replaceChild(newOkBtn, oldOkBtn);
            
            newOkBtn.addEventListener('click', () => {
                messageBox.classList.add('opacity-0', '-translate-y-10');
                setTimeout(() => {
                    messageBox.classList.add('hidden');
                    if (onOkCallback) onOkCallback();
                }, 300);
            }, { once: true });

            messageBox.classList.remove('hidden');
            setTimeout(() => {
                messageBox.classList.remove('opacity-0', '-translate-y-10');
            }, 10);
        }

        function startTimer(duration, displayElement, onEndCallback) {
            clearInterval(timerId);
            timerValue = duration;
            displayElement.textContent = timerValue;
            
            timerId = setInterval(() => {
                timerValue--;
                displayElement.textContent = timerValue;
                
                if (timerValue <= 0) {
                    clearInterval(timerId);
                    onEndCallback();
                }
            }, 1000);
        }

        function loadQuestion(qArea, qTextEl, qAnswersEl, roundType) {
            let q;
            
            if (roundType === 'R1') {
                if (r1QuestionIndex >= shuffledR1Questions.length) {
                    r1QuestionIndex = 0;
                    shuffleArray(shuffledR1Questions);
                }
                q = shuffledR1Questions[r1QuestionIndex];
                r1QuestionIndex++;
                
            } else if (roundType === 'R2') {
                if (r2QuestionIndex >= shuffledR2Questions.length) {
                    r2QuestionIndex = 0;
                    shuffleArray(shuffledR2Questions);
                }
                q = shuffledR2Questions[r2QuestionIndex];
                r2QuestionIndex++;
                
            } else if (roundType === 'FinalTeam') {
                if (r3QuestionIndex >= shuffledR3Questions.length) {
                    r3QuestionIndex = 0;
                    shuffleArray(shuffledR3Questions);
                }
                q = shuffledR3Questions[r3QuestionIndex];
                r3QuestionIndex++;
            }
            
            if (!q) {
                qTextEl.textContent = "Error: No questions found.";
                return;
            }

            qTextEl.textContent = q.q;
            qAnswersEl.innerHTML = '';
            
            const shuffledAnswers = [...q.a];
            shuffleArray(shuffledAnswers);
            
            shuffledAnswers.forEach(answer => {
                const button = document.createElement('button');
                button.textContent = answer.t;
                // Festive Button Styling
                button.className = "w-full p-4 bg-red-700 hover:bg-red-600 border-2 border-yellow-500 rounded-xl font-bold text-lg text-white transition-all transform hover:scale-102 shadow-md";
                
                button.addEventListener('click', () => {
                    qAnswersEl.querySelectorAll('button').forEach(btn => btn.disabled = true);
                    
                    button.classList.remove('bg-red-700', 'hover:bg-red-600');
                    if (answer.c) {
                        button.classList.add('flash-green');
                    } else {
                        button.classList.add('flash-red');
                    }
                    
                    setTimeout(() => {
                        handleAnswer(roundType, answer.c);
                        button.classList.remove('flash-green', 'flash-red');
                        button.classList.add('bg-red-700', 'hover:bg-red-600');
                    }, 500);
                });
                qAnswersEl.appendChild(button);
            });
        }

        function updateGlobalScoreboard() {
            let teamsDone = 0;
            
            for (let i = 0; i < 5; i++) {
                const scoreEl = document.getElementById(`team-${i+1}-score`);
                const teamBox = document.getElementById(`team-score-${i+1}`);
                scoreEl.textContent = teamScores[i];
                
                const selectBtn = document.querySelector(`.team-select-btn[data-team="${i}"]`);
                
                // Reset styles
                teamBox.classList.remove('bg-green-700', 'bg-red-900', 'bg-gray-800');

                if (teamScores[i] > 0) {
                    // Qualified
                    teamBox.classList.add('bg-green-700'); 
                    selectBtn.classList.add('bg-green-700', 'opacity-50', 'cursor-not-allowed');
                    selectBtn.innerHTML = `Team ${i+1} ğŸ„`;
                    selectBtn.disabled = true;
                    teamsDone++;
                } else if (teamPlayingStatus[i] === false && selectBtn.disabled) {
                    // Eliminated
                    teamBox.classList.add('bg-gray-800', 'opacity-50');
                    selectBtn.classList.add('bg-gray-600', 'opacity-50');
                    selectBtn.innerHTML = `Team ${i+1} â˜ ï¸`;
                    teamsDone++;
                } else {
                    // Not played yet
                     teamBox.classList.add('bg-green-900');
                }
            }
            
            if (teamsDone === 5) {
                document.getElementById('start-final-chase-btn').classList.remove('hidden');
            } else {
                document.getElementById('start-final-chase-btn').classList.add('hidden');
            }
        }

        function handleAnswer(roundType, isCorrect) {
            if (roundType === 'R1') {
                if (isCorrect) {
                    currentCashBuilderBank += 1000; // Bigger numbers for xmas gifts
                    document.getElementById('r1-bank').textContent = currentCashBuilderBank;
                }
                loadQuestion('r1-question-area', document.getElementById('r1-question-text'), document.getElementById('r1-answer-buttons'), 'R1');
            } 
            else if (roundType === 'R2') {
                checkRound2Answer(isCorrect);
            }
            else if (roundType === 'FinalTeam') {
                if (isCorrect) {
                    finalChaseTeamScore++;
                    document.getElementById('final-team-score').textContent = finalChaseTeamScore;
                }
                loadQuestion('final-team-question-area', document.getElementById('final-team-question-text'), document.getElementById('final-team-answer-buttons'), 'FinalTeam');
            }
        }

        // --- Logic: Round 1 (Setup & Play) ---
        function initializeSetupScreen() {
            document.querySelectorAll('.team-select-btn').forEach(button => {
                button.addEventListener('click', () => {
                    currentActiveTeam = parseInt(button.dataset.team);
                    
                    document.querySelectorAll('.team-select-btn').forEach(btn => {
                        btn.classList.remove('ring-4', 'ring-yellow-300', 'scale-110');
                        if (!btn.disabled) {
                           // btn.classList.add('bg-red-600');
                        }
                    });
                    button.classList.add('ring-4', 'ring-yellow-300', 'scale-110');
                    
                    document.getElementById('start-round-1-btn').disabled = false;
                    document.getElementById('start-round-1-btn').classList.remove('opacity-50');
                });
            });

            document.getElementById('start-round-1-btn').addEventListener('click', startRound1);
            document.getElementById('start-final-chase-btn').addEventListener('click', startFinalChase);
            document.getElementById('play-again-btn').addEventListener('click', resetGame);
        }

        function startRound1() {
            if (currentActiveTeam === -1) return;
            
            const selectBtn = document.querySelector(`.team-select-btn[data-team="${currentActiveTeam}"]`);
            selectBtn.disabled = true;
            
            currentCashBuilderBank = 0;
            document.getElementById('r1-bank').textContent = '0';
            document.getElementById('r1-team-name').textContent = `Team ${currentActiveTeam + 1} is gathering gifts!`;
            
            document.getElementById('r1-start-timer-btn').classList.remove('hidden');
            document.getElementById('r1-question-area').classList.add('hidden');
            
            showScreen('cashBuilder');
        }
        
        document.getElementById('r1-start-timer-btn').addEventListener('click', () => {
            document.getElementById('r1-start-timer-btn').classList.add('hidden');
            document.getElementById('r1-question-area').classList.remove('hidden');
            
            // Reduced to 30s to balance question count
            startTimer(30, document.getElementById('r1-timer'), endRound1);
            loadQuestion('r1-question-area', document.getElementById('r1-question-text'), document.getElementById('r1-answer-buttons'), 'R1');
        });
        
        function endRound1() {
            clearInterval(timerId);
            showMessage('Sleigh Bells Ring!', `Team ${currentActiveTeam + 1} gathered ${currentCashBuilderBank} gifts!`, () => {
                document.getElementById('offer-team-name').textContent = `Team ${currentActiveTeam + 1}`;
                document.getElementById('offer-bank-amount').textContent = currentCashBuilderBank;
                showScreen('offer');
            });
        }
        
        // --- Logic: Round 2 (Head to Head) ---
        document.getElementById('start-round-2-btn').addEventListener('click', () => {
             // Play Audio Here
            try {
                chaserMusic.currentTime = 0;
                chaserMusic.play();
            } catch (e) {
                console.warn("Audio could not play (user interaction may be needed).", e);
            }
            startRound2();
        });

        function startRound2() {
            currentRound2TeamScore = 0;
            currentRound2ChaserScore = 0;
            document.getElementById('r2-team-money').textContent = currentCashBuilderBank;
            
            updateBoardVisuals();
            showScreen('headToHead');
            loadQuestion('r2-question-area', document.getElementById('r2-question-text'), document.getElementById('r2-answer-buttons'), 'R2');
        }

        function checkRound2Answer(isCorrect) {
            if (isCorrect) {
                currentRound2TeamScore++;
            } else {
                currentRound2ChaserScore++;
            }
            updateBoardVisuals();
            
            if (currentRound2TeamScore === 5) {
                teamScores[currentActiveTeam] = currentCashBuilderBank;
                teamPlayingStatus[currentActiveTeam] = true;
                showMessage('Safe at Home!', `Team ${currentActiveTeam + 1} escapes with ${currentCashBuilderBank} gifts!`, goToSetupScreen);
            } else if (currentRound2ChaserScore === 5) {
                teamPlayingStatus[currentActiveTeam] = false;
                showMessage('The Grinch Stole It!', `Team ${currentActiveTeam + 1} lost their gifts!`, goToSetupScreen);
            } else {
                loadQuestion('r2-question-area', document.getElementById('r2-question-text'), document.getElementById('r2-answer-buttons'), 'R2');
            }
        }
        
        function updateBoardVisuals() {
            document.getElementById('r2-team-score').textContent = currentRound2TeamScore;
            document.getElementById('r2-chaser-score').textContent = currentRound2ChaserScore;
            
            const stepHeightPercent = 100 / 6;
            const playerStep = 3 + (currentRound2TeamScore * (3/5));
            const chaserStep = currentRound2ChaserScore;
            
            document.getElementById('player-icon').style.transform = `translateY(${playerStep * stepHeightPercent}%)`;
            document.getElementById('chaser-icon').style.transform = `translateY(${chaserStep * stepHeightPercent}%)`;
        }
        
        function goToSetupScreen() {
            currentActiveTeam = -1;
            document.getElementById('start-round-1-btn').disabled = true;
            document.getElementById('start-round-1-btn').classList.add('opacity-50');
            document.querySelectorAll('.team-select-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-yellow-300', 'scale-110');
            });
            updateGlobalScoreboard();
            showScreen('setup');
        }

        // --- Logic: Final Chase (Team) ---
        function startFinalChase() {
            finalChaseTotalPot = 0;
            let teamsInFinal = 0;
            let teamsList = [];

            for(let i=0; i<5; i++) {
                if(teamPlayingStatus[i] === true) {
                    finalChaseTotalPot += teamScores[i];
                    teamsInFinal++;
                    teamsList.push(`Team ${i+1}`);
                }
            }

            if (teamsInFinal === 0) {
                showMessage("Christmas is Cancelled!", "The Grinch caught everyone. No gifts this year!", resetGame);
                return;
            }
            
            finalChaseTeamScore = teamsInFinal; // Headstart
            
            document.getElementById('final-teams-list').textContent = teamsList.join(', ');
            document.getElementById('final-team-score').textContent = finalChaseTeamScore;
            document.getElementById('final-pot').textContent = finalChaseTotalPot;
            
            document.getElementById('final-team-start-btn').classList.remove('hidden');
            document.getElementById('final-team-question-area').classList.add('hidden');
            
            showScreen('finalTeam');
        }

        document.getElementById('final-team-start-btn').addEventListener('click', () => {
            document.getElementById('final-team-start-btn').classList.add('hidden');
            document.getElementById('final-team-question-area').classList.remove('hidden');
            startTimer(60, document.getElementById('final-team-timer'), endTeamFinalChase);
            loadQuestion('final-team-question-area', document.getElementById('final-team-question-text'), document.getElementById('final-team-answer-buttons'), 'FinalTeam');
        });

        function endTeamFinalChase() {
            clearInterval(timerId);
            showMessage('Time is Up!', `The Elves have set a target of ${finalChaseTeamScore}! Can the Grinch catch them?`, () => {
                document.getElementById('final-chaser-team-target').textContent = finalChaseTeamScore;
                document.getElementById('final-chaser-score').textContent = '0';
                document.getElementById('final-chaser-start-btn').classList.remove('hidden');
                document.getElementById('teacher-controls').classList.add('hidden');
                document.getElementById('final-chaser-question-area').classList.add('hidden');
                showScreen('finalChaser');
            });
        }

        // --- Logic: Final Chase (Grinch/Teacher) ---
        function loadChaserQuestion() {
            if (r3ChaserQuestionIndex >= shuffledR3ChaserQuestions.length) {
                r3ChaserQuestionIndex = 0;
                shuffleArray(shuffledR3ChaserQuestions);
            }
            const q = shuffledR3ChaserQuestions[r3ChaserQuestionIndex];
            r3ChaserQuestionIndex++;
            
            if (q) {
                document.getElementById('final-chaser-question-text').textContent = q.q;
            }
        }
        
        function resumeChaserTimer() {
            startTimer(timerValue, document.getElementById('final-chaser-timer'), endChaserFinalChase);
            document.getElementById('teacher-pushback-controls').classList.add('hidden');
            document.getElementById('teacher-main-controls').classList.remove('hidden');
        }
        
        document.getElementById('final-chaser-start-btn').addEventListener('click', () => {
            document.getElementById('final-chaser-start-btn').classList.add('hidden');
            document.getElementById('teacher-controls').classList.remove('hidden');
            document.getElementById('teacher-main-controls').classList.remove('hidden');
            document.getElementById('teacher-pushback-controls').classList.add('hidden');
            document.getElementById('final-chaser-question-area').classList.remove('hidden');
            loadChaserQuestion();
            startTimer(60, document.getElementById('final-chaser-timer'), endChaserFinalChase);
        });
        
        document.getElementById('chaser-correct-btn').addEventListener('click', () => {
            finalChaseChaserScore++;
            document.getElementById('final-chaser-score').textContent = finalChaseChaserScore;
            if (finalChaseChaserScore >= finalChaseTeamScore) {
                clearInterval(timerId);
                showEndScreen(false); 
            } else {
                loadChaserQuestion();
            }
        });
        
        document.getElementById('chaser-incorrect-btn').addEventListener('click', () => {
            clearInterval(timerId);
            document.getElementById('teacher-pushback-controls').classList.remove('hidden');
            document.getElementById('teacher-main-controls').classList.add('hidden');
        });

        document.getElementById('pushback-correct-btn').addEventListener('click', () => {
            if (finalChaseChaserScore > 0) {
                finalChaseChaserScore--;
                document.getElementById('final-chaser-score').textContent = finalChaseChaserScore;
            }
            loadChaserQuestion();
            resumeChaserTimer();
        });
        
        document.getElementById('pushback-incorrect-btn').addEventListener('click', () => {
            loadChaserQuestion();
            resumeChaserTimer();
        });

        function endChaserFinalChase() {
            clearInterval(timerId);
            if (finalChaseChaserScore >= finalChaseTeamScore) {
                showEndScreen(false);
            } else {
                showEndScreen(true); 
            }
        }
        
        // --- Logic: End Screen ---
        function showEndScreen(teamsWin) {
            if (teamsWin) {
                document.getElementById('end-emoji').textContent = 'ğŸ…ğŸ„ğŸ';
                document.getElementById('end-title').textContent = 'MERRY CHRISTMAS!';
                document.getElementById('end-message').textContent = `The Teams saved Christmas and won ${finalChaseTotalPot} gifts!`;
                document.getElementById('end-title').className = "text-6xl font-festive mb-6 drop-shadow-lg text-green-400";
            } else {
                document.getElementById('end-emoji').textContent = 'ğŸ‘¹ğŸğŸ–¤';
                document.getElementById('end-title').textContent = 'THE GRINCH WINS!';
                document.getElementById('end-message').textContent = 'He stole all the presents... better luck next year.';
                document.getElementById('end-title').className = "text-6xl font-festive mb-6 drop-shadow-lg text-red-500";
            }
            showScreen('end');
        }

        // --- Logic: Reset ---
        function resetGame() {
            teamScores = [0, 0, 0, 0, 0];
            teamPlayingStatus = [false, false, false, false, false];
            currentActiveTeam = -1;
            
            // Re-shuffle
            shuffledR1Questions = [...round1Questions];
            shuffledR2Questions = [...round2Questions];
            shuffledR3Questions = [...finalChaseQuestions];
            shuffledR3ChaserQuestions = [...finalChaseChaserQuestions];
            shuffleArray(shuffledR1Questions);
            shuffleArray(shuffledR2Questions);
            shuffleArray(shuffledR3Questions);
            shuffleArray(shuffledR3ChaserQuestions);

            clearInterval(timerId);
            
            // Reset Board UI
            for(let i=1; i<=5; i++) {
                document.getElementById(`team-${i}-score`).textContent = '0';
                document.getElementById(`team-score-${i}`).className = "p-4 bg-green-900 rounded-xl shadow-inner border border-green-700 min-w-[120px]";
                
                const btn = document.querySelector(`.team-select-btn[data-team="${i-1}"]`);
                btn.disabled = false;
                btn.className = "team-select-btn p-6 bg-red-600 hover:bg-red-700 rounded-2xl font-bold text-xl w-40 transition-all shadow-lg border-b-4 border-red-800";
                btn.innerHTML = `Team ${i} ğŸ`;
            }
            
            document.getElementById('start-round-1-btn').disabled = true;
            document.getElementById('start-round-1-btn').classList.add('opacity-50');
            document.getElementById('start-final-chase-btn').classList.add('hidden');
            
            showScreen('setup');
        }

        // --- Initialize ---
        document.addEventListener('DOMContentLoaded', () => {
            shuffledR1Questions = [...round1Questions];
            shuffledR2Questions = [...round2Questions];
            shuffledR3Questions = [...finalChaseQuestions];
            shuffledR3ChaserQuestions = [...finalChaseChaserQuestions];
            shuffleArray(shuffledR1Questions);
            shuffleArray(shuffledR2Questions);
            shuffleArray(shuffledR3Questions);
            shuffleArray(shuffledR3ChaserQuestions);
            
            initializeSetupScreen();
            
            document.getElementById('message-ok-btn').addEventListener('click', () => {
                messageBox.classList.add('hidden', 'opacity-0', '-translate-y-10');
            });
            
            showScreen('setup');
        });

    </script>

</body>
</html>